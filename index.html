<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PSN — Project Solar Node</title>
  <meta name="description" content="PSN: Documentation, BOMs, build logs, and collaboration hub." />
  <style>
    :root{--bg:#0f1724;--muted:#9aa4b2;--accent:#fb923c}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,#071025,#081428);color:#e6eef6}
    header{padding:22px 28px;display:flex;gap:14px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:800}
    .wrap{max-width:1100px;margin:0 auto;padding:0 28px 32px}
    h1{margin:0;font-size:28px}
    .muted{color:var(--muted)}
    .card{background:rgba(255,255,255,0.04);border-radius:12px;padding:18px;margin-top:18px;box-shadow:0 6px 18px rgba(2,6,23,.5)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    a{color:#cfe8ff;text-decoration:none}
    a.btn{display:inline-block;padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,var(--accent),#7c3aed);color:#061026;font-weight:700}
    ul{margin:8px 0 0 18px}
    .small{font-size:12px}
    footer{padding:26px;text-align:center;color:var(--muted)}
    code{background:rgba(255,255,255,0.06);padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <header>
    <div class="logo">PSN</div>
    <div>
      <h1>Project Solar Node</h1>
      <div class="muted small">Docs • Builds • BOMs • Collaboration</div>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <p class="muted">This homepage auto-indexes your GitHub repo. Add or move files in the repo and this page updates itself on refresh.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
        <a class="btn" href="https://github.com/davidgritton015-code/psn-site" target="_blank" rel="noopener">Open Repository</a>
        <a class="btn" href="#docs">Docs Index</a>
        <a class="btn" href="#boms">BOMs</a>
      </div>
    </div>

    <div class="grid">
      <section class="card" id="docs">
        <h2>Documentation (Markdown)</h2>
        <div id="docsList" class="muted">Loading…</div>
      </section>

      <section class="card" id="boms">
        <h2>BOMs (CSV)</h2>
        <div id="bomList" class="muted">Loading…</div>
      </section>
    </div>

    <section class="card">
      <h3>How this works</h3>
      <ol class="muted">
        <li>Client-side fetch to the GitHub API grabs a list of files in <code>main</code>.</li>
        <li>We list <code>.md</code> and <code>.csv</code> files. Markdown links open in GitHub’s viewer.</li>
        <li>Keep using your mirrored Google Drive structure—no extra steps.</li>
      </ol>
      <p class="small muted">If you ever hit API rate limits (rare), just refresh later or we can switch to a prebuilt manifest file.</p>
    </section>
  </div>

  <footer>Built for PSN — simple now, easy to upgrade later.</footer>

  <script>
  // CONFIG
  const owner = "davidgritton015-code";
  const repo  = "psn-site";
  const branch = "main";

  const api = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
  const docsList = document.getElementById("docsList");
  const bomList  = document.getElementById("bomList");

  function groupByTopLevel(paths) {
    const groups = {};
    for (const p of paths) {
      const top = p.includes("/") ? p.split("/")[0] : "(root)";
      groups[top] = groups[top] || [];
      groups[top].push(p);
    }
    return groups;
  }

  function makeGroupList(groups, isCsv=false) {
    const container = document.createElement("div");
    for (const top of Object.keys(groups).sort()) {
      const section = document.createElement("div");
      section.style.marginBottom = "10px";
      const title = document.createElement("div");
      title.innerHTML = `<strong>${top}</strong>`;
      section.appendChild(title);

      const ul = document.createElement("ul");
      for (const path of groups[top].sort()) {
        const li = document.createElement("li");
        const href = `https://github.com/${owner}/${repo}/blob/${branch}/${encodeURI(path)}`;
        li.innerHTML = `<a href="${href}" target="_blank" rel="noopener">${path.replace(top + "/", "")}</a>`;
        ul.appendChild(li);
      }
      section.appendChild(ul);
      container.appendChild(section);
    }
    return container;
  }

  fetch(api)
    .then(r => {
      if (!r.ok) throw new Error("GitHub API error: " + r.status);
      return r.json();
    })
    .then(data => {
      const tree = (data.tree || []).filter(n => n.type === "blob").map(n => n.path);

      const mdFiles  = tree.filter(p => p.toLowerCase().endsWith(".md"));
      const csvFiles = tree.filter(p => p.toLowerCase().endsWith(".csv"));

      if (mdFiles.length) {
        const groups = groupByTopLevel(mdFiles);
        docsList.innerHTML = "";
        docsList.classList.remove("muted");
        docsList.appendChild(makeGroupList(groups));
      } else {
        docsList.textContent = "No Markdown files found.";
      }

      if (csvFiles.length) {
        const groups = groupByTopLevel(csvFiles);
        bomList.innerHTML = "";
        bomList.classList.remove("muted");
        bomList.appendChild(makeGroupList(groups, true));
      } else {
        bomList.textContent = "No CSV files found.";
      }
    })
    .catch(err => {
      console.error(err);
      docsList.textContent = "Couldn’t load file list (API limit or network).";
      bomList.textContent  = "Couldn’t load file list (API limit or network).";
    });
  </script>
</body>
</html>

