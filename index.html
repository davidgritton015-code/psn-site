<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PSN — Project Solar Node</title>
  <meta name="description" content="PSN: Documentation, BOMs, build logs, and collaboration hub." />
  <style>
    :root{--muted:#9aa4b2;--accent:#fb923c}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,#071025,#0b1530);color:#e6eef6}
    header{padding:22px 28px;display:flex;gap:14px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:800}
    .wrap{max-width:1100px;margin:0 auto;padding:0 28px 40px}
    h1{margin:0;font-size:28px}
    .muted{color:var(--muted)}
    .card{background:rgba(255,255,255,0.04);border-radius:12px;padding:18px;margin-top:18px;box-shadow:0 6px 18px rgba(2,6,23,.5)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    a{color:#cfe8ff;text-decoration:none}
    a.btn{display:inline-block;padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,var(--accent),#7c3aed);color:#061026;font-weight:700}
    ul{margin:8px 0 0 18px}
    .small{font-size:12px}
    footer{padding:26px;text-align:center;color:var(--muted)}
    input[type="search"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #203051;background:#0b1730;color:#e6eef6}
    .toplinks{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  </style>
</head>
<body>
  <header>
    <div class="logo">PSN</div>
    <div>
      <h1>Project Solar Node</h1>
      <div class="muted small">Docs • Builds • BOMs • Collaboration</div>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <p class="muted">This homepage auto-indexes your GitHub repo. Add/move files in the repo and refresh to update.</p>
      <div class="toplinks">
        <a class="btn" href="https://github.com/davidgritton015-code/psn-site" target="_blank" rel="noopener">Open Repository</a>
        <a class="btn" href="#docs">Docs</a>
        <a class="btn" href="#boms">BOMs</a>
        <a class="btn" href="#all">All Files</a>
      </div>
    </div>

    <div class="card">
      <input id="search" type="search" placeholder="Search filenames (e.g., phase, verdant, ember, wiring)…" />
      <div class="small muted" style="margin-top:6px">Filters the lists below by filename.</div>
    </div>

    <div class="grid">
      <section class="card" id="docs">
        <h2>Documentation (Markdown)</h2>
        <div id="docsList" class="muted">Loading…</div>
      </section>

      <section class="card" id="boms">
        <h2>BOMs (CSV)</h2>
        <div id="bomList" class="muted">Loading…</div>
      </section>
    </div>

    <section class="card" id="all">
      <h2>All Files (by top-level folder)</h2>
      <div id="allList" class="muted">Loading…</div>
    </section>

    <section class="card">
      <h3>Notes</h3>
      <ul class="muted">
        <li>Markdown links open in GitHub’s viewer for clean rendering.</li>
        <li>If GitHub API rate-limits you (rare), refresh later. We can switch to a prebuilt manifest if needed.</li>
      </ul>
    </section>
  </div>

  <footer>Built for PSN — simple now, easy to upgrade later.</footer>

  <script>
  // ===== CONFIG =====
  const owner  = "davidgritton015-code";
  const repo   = "psn-site";
  const branch = "main";
  const api    = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

  const $docs = document.getElementById("docsList");
  const $boms = document.getElementById("bomList");
  const $all  = document.getElementById("allList");
  const $search = document.getElementById("search");

  // Title-ize a filename: "phase-2.md" -> "Phase 2"
  function nicename(p){
    const name = p.split("/").pop().replace(/\.[^/.]+$/, "");
    return name.replace(/[-_]+/g," ").replace(/\b\w/g, c=>c.toUpperCase());
  }
  function topLevel(path){ return path.includes("/") ? path.split("/")[0] : "(root)"; }

  function group(paths){
    return paths.reduce((m,p)=>{ (m[topLevel(p)]??=[]).push(p); return m; },{});
  }
  function list(groups, exts){
    const wrap = document.createElement("div");
    Object.keys(groups).sort().forEach(top=>{
      const sect = document.createElement("div"); sect.style.marginBottom="12px";
      const title = document.createElement("div"); title.innerHTML = `<strong>${top}</strong>`;
      const ul = document.createElement("ul");
      [...groups[top]].sort().forEach(p=>{
        const ok = exts?.some(ext=>p.toLowerCase().endsWith(ext)) ?? true;
        if(!ok) return;
        const li = document.createElement("li");
        const href = `https://github.com/${owner}/${repo}/blob/${branch}/${encodeURI(p)}`;
        li.innerHTML = `<a href="${href}" target="_blank" rel="noopener">${nicename(p)}</a> <span class="small muted">(${p})</span>`;
        ul.appendChild(li);
      });
      sect.appendChild(title); sect.appendChild(ul); wrap.appendChild(sect);
    });
    return wrap;
  }

  let treePaths = [];
  function render(filter=""){
    const f = filter.trim().toLowerCase();
    const visible = f ? treePaths.filter(p=>p.toLowerCase().includes(f)) : treePaths.slice();

    const md  = visible.filter(p=>p.toLowerCase().endsWith(".md"));
    const csv = visible.filter(p=>p.toLowerCase().endsWith(".csv"));

    // Docs
    if(md.length){ $docs.innerHTML=""; $docs.classList.remove("muted"); $docs.appendChild(list(group(md), [".md"])); }
    else { $docs.textContent = "No Markdown files found."; }

    // BOMs
    if(csv.length){ $boms.innerHTML=""; $boms.classList.remove("muted"); $boms.appendChild(list(group(csv), [".csv"])); }
    else { $boms.textContent = "No CSV files found."; }

    // All files (any extension)
    if(visible.length){ $all.innerHTML=""; $all.classList.remove("muted"); $all.appendChild(list(group(visible))); }
    else { $all.textContent = "No files match your search."; }
  }

  fetch(api)
    .then(r=>{ if(!r.ok) throw new Error("GitHub API "+r.status); return r.json(); })
    .then(js=>{
      treePaths = (js.tree||[]).filter(n=>n.type==="blob").map(n=>n.path);
      render();
    })
    .catch(err=>{
      console.error(err);
      $docs.textContent = "Couldn’t load (API/network).";
      $boms.textContent = "Couldn’t load (API/network).";
      $all.textContent  = "Couldn’t load (API/network).";
    });

  $search.addEventListener("input", e=>render(e.target.value));
  </script>
</body>
</html>


